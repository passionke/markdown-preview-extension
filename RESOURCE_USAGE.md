# 资源消耗说明

## Web服务器资源消耗分析

### 内存消耗

**基础内存占用**：
- HTTP服务器实例：约 2-5 MB
- Node.js HTTP模块：约 1-2 MB
- 扩展运行时：约 5-10 MB

**动态内存（预览会话）**：
- 每个预览会话：约 50-500 KB（取决于Markdown文件大小）
- 最大会话数：默认50个，最多占用约 25 MB
- 自动清理：超过30分钟未访问的会话会自动清理

**总内存占用**：约 10-40 MB（取决于活跃会话数）

### CPU消耗

**正常情况**：
- 空闲时：接近 0%（服务器处于监听状态）
- 处理请求时：< 1%（简单的内存查找和HTML返回）

**渲染Markdown时**：
- 首次预览：约 5-50 ms CPU时间（取决于文件大小）
- 后续访问：< 1 ms（直接从内存返回）

### 网络资源

**本地网络**：
- 仅监听 `127.0.0.1`（localhost），不占用外部网络
- 带宽消耗：几乎为0（本地回环）
- 端口占用：默认3000（可配置）

### 磁盘IO

**无磁盘操作**：
- HTML内容存储在内存中，不创建临时文件
- 仅在读取Markdown文件时有一次磁盘读取
- 无日志文件写入（除非调试模式）

## 优化特性

1. **单例模式**：整个扩展生命周期只有一个服务器实例
2. **按需启动**：只在首次预览时启动服务器
3. **自动清理**：定期清理过期会话，防止内存泄漏
4. **会话限制**：最多50个会话，超出时自动清理最旧的
5. **轻量级**：使用Node.js原生HTTP模块，无额外依赖

## 配置选项

可以在VSCode设置中调整以下参数：

- `markdownPreview.serverPort`: 服务器端口（默认3000）
- `markdownPreview.maxSessions`: 最大会话数（默认50）
- `markdownPreview.sessionTimeout`: 会话超时时间，分钟（默认30）
- `markdownPreview.autoStartServer`: 是否自动启动（默认true）

## 服务器控制命令

通过命令面板（`Cmd+Shift+P`）可以使用以下命令：

- **Start Preview Server**: 手动启动服务器
- **Stop Preview Server**: 停止服务器
- **Restart Preview Server**: 重启服务器
- **Show Server Status**: 显示服务器状态（运行状态、端口、会话数）

## 性能建议

1. **正常使用**：默认配置即可，资源消耗很低
2. **大量预览**：如果经常预览很多文件，可以增加 `maxSessions`
3. **内存敏感**：如果内存紧张，可以减少 `maxSessions` 或缩短 `sessionTimeout`
4. **端口冲突**：如果3000端口被占用，会自动查找可用端口

## 监控

可以通过以下方式监控资源使用：

1. **查看服务器状态**：使用命令 "Show Server Status"
2. **VSCode任务管理器**：查看扩展进程的资源使用
3. **系统监控工具**：macOS Activity Monitor / Windows Task Manager

## 总结

该扩展的资源消耗非常低：
- ✅ 内存占用：10-40 MB（可配置）
- ✅ CPU占用：< 1%（正常情况）
- ✅ 网络：仅本地，无外部请求
- ✅ 磁盘：几乎无IO操作
- ✅ 自动优化：自动清理过期资源

适合长期运行，不会对系统性能造成明显影响。
